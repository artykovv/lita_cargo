{% extends "base.html" %} {% block content %}


<div class="">
    <div class="p-4 p-md-5 mb-4 rounded text-body-emphasis bg-white shadow-sm">

        <span class="text-bg-success rounded-pill p-2 fs-6">Отчет за сегодня</span>
        <div>
            <div id="report" class="d-flex justify-content-around"></div>
            <div class="d-flex justify-content-center">
                <a class="mt-5 btn btn-primary" href="/reports">Посмотреть детальнее</a>
            </div>
        </div>
    </div>

    <div>
        <div class="row row-cols-1 row-cols-md-3 mb-3 text-center">
            <div class="col">
                <div class="card-body bg-white rounded shadow-sm">
                    <p class="pt-5">количество клиентов</p>
                    <h1 id="clients-count" class="card-title pricing-card-title" style="font-size: 100px;"><small class="text-body-secondary fw-light"></small></h1>
                    <div class="pb-5 mt-1">
                        <a href="/registration" class="btn btn-primary">Регистрация</a>
                    </div>
                </div>
              </div>

              <div class="col">
                <div class="card-body bg-white rounded">
                    <p class="mt-5">количество клиентов</p>
                    <h1 id="clients-count" class="card-title pricing-card-title mb-5">100<small class="text-body-secondary fw-light"></small></h1>
                </div>
              </div>

            </div>
          </div>
    </div>
</div>

<script>
    async function fetchDailyReport() {
        try {
            const response = await fetch('/api/routes/report/today', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                const report = await response.json();
                displayReport(report);
            } else {
                const error = await response.json();
                document.getElementById('report').innerHTML = `<p>Ошибка: ${error.detail}</p>`;
            }
        } catch (error) {
            document.getElementById('report').innerHTML = `<p>Ошибка: ${error.message}</p>`;
        }
    }

    async function fetchClientsCount() {
        try {
            const response = await fetch('/api/routes/report/clients/count', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                const data = await response.json();
                document.getElementById('clients-count').textContent = data.total_clients;
            } else {
                document.getElementById('clients-count').textContent = 'Ошибка';
            }
        } catch (error) {
            document.getElementById('clients-count').textContent = 'Ошибка';
        }
    }

    function displayReport(report) {
        let reportHtml = '';

        const totalAmount = report.find((item) => item.total_amount_all_clients);
        const totalClients = report.find((item) => item.total_clients_with_products);

        if (totalAmount) {
            reportHtml += `
                <div class='d-flex flex-column align-items-center'>
                    <p style="font-size: 100px;">${totalAmount.total_amount_all_clients}</p>
                    <p>Общая сумма за сегодня</p>
                </div>`;
        }

        if (totalClients) {
            reportHtml += `
                <div class='d-flex flex-column align-items-center'>
                    <p style="font-size: 100px;">${totalClients.total_clients_with_products}</p>
                    <p>Количество клиентов за сегодня</p>
                </div>`;
        }

        document.getElementById('report').innerHTML = reportHtml;
    }

    document.addEventListener('DOMContentLoaded', () => {
        fetchDailyReport();
        fetchClientsCount();
    });
</script>
  {% endblock %}
</div>
